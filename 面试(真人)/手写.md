# æ‰‹å†™ä»£ç 

## iterator

## åŒå‘æ•°æ®ç»‘å®š

## call

```js
Function.prototype.myCall = function () {
    let ctx = [...arguments].shift() || window;
    ctx.fn = this;
    let arg = [...arguments].slice(1);
    let result = ctx.fn(...arg);
    delete ctx.fn
    return result

}
let obj = {x: 1};
function tst(a) {console.log(this.x, a)};
tst.myCall(obj, 2);
```

```js
Function.prototype.myBind = function () {
    let obj = [].slice.call(arguments);
    let arg = arguments;
    let fn = this;
    return function fn1() => {
        if(this instanceof fn) {
            return new fn1()
        }
        this.apply(obj, [...arg, ...arguments])
    }
}
```

## compose(6/7;)

```js
// ç”¨æ³•å¦‚ä¸‹:
function fn1(x) {
  return x + 1;
}
function fn2(x) {
  return x + 2;
}
function fn3(x) {
  return x + 3;
}
function fn4(x) {
  return x + 4;
}
const a = compose(fn1, fn2, fn3, fn4);
console.log(a(1)); // 1+4+3+2+1=11

function compose() {
    let arg = [].slice.call(arguments);
    return (x) => {
        return arg.reduceRight((pre, cur) => cur(pre), x);
    }
}

```

## setTimeout å®ç°setInterval

## å‘å¸ƒè®¢é˜…æ¨¡å¼

```js
class EventEmitter {
    constructor () {
        this.events = {}
    }

    on (name, fn) {
        if (!this.events[name]) {
            this.events[name] = []
        }
        this.events[name].push(fn);
    }
    emit (name, ...value) {
        if (!this.events[name]) {
            return;
        };
        this.events[name].forEach(v => {
            v.apply(this, value)
        });
    }
    off (name, fn) {
        if (!this.events[name]) {
            return;
        };
        this.events[name] = this.events[name].filter(v => {
            return v !== fn
        }); 
    }
    once(name, fn) {
        function packageFn() {
            fn(...arguments);
            this.off(name, packageFn)
        }
        this.on(name, packageFn)
    }
}
let event1 = new EventEmitter();
event1.on('12', (val) => {console.log(11, val)})
event1.once('12', (val) => {console.log(22, val)})
event1.emit('12', 33);
event1.emit('12', 33)
```

## æ•°ç»„å»é‡

```js
[...new Set(arr)]
```

## é™ç»´åº¦

```js
console.log(flatter([1, 2, [1, [2, 3, [4, 5, [6]]]]]));
// é€’å½’

function flatter(arr) {
    return arr.reduce((pre, cur) => {
        Array.isArray(cur) ? pre.concat(flatter(cur)) : pre.concat(cur)
    }, [])
}

function flatter (arr) {
    while (arr.some(val => Array.isArray(val))) {
        arr = [].concat(...arr);
    }
    return arr;
}
```

## ç»§æ‰¿es5(å¯„ç”Ÿç»„åˆç»§æ‰¿)

```js
function Parent (name) {
    this.name = name;
    this.inner = function () {
        console.log('inner' + this.name)
    }
}
Parent.prototype.outer = function () {
    console.log('outer' + this.name)
}
function Child (name) {
    A.call(this);
    this.name = name
}
Child.prototype = Object.create(Parent.prototype, {
    constructor: {
        value: Child,
        writable: true,
        enumerable: false,
        configurable: false
    }
})
let child = new Child('Dragon');
child.inner();
child.outer();
```

## new

```js
let myCreate = function () {
    let fn = [].shift.call(arguments);
    // åˆ›å»ºç©ºå¯¹è±¡,å¹¶æŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹
    let obj = Object.create(fn.prototype);
    // ç»‘å®šthis æ‰§è¡Œ ,åŒæ—¶æ‰§è¡Œæ„é€ å‡½æ•°
    let ret = fn.call(obj, ...arguments);
    return ret instanceof Object ? ret : obj;
}
function Person(name, age) {
    this.name = name;
    this.age = age;
}
Person.prototype.say = function() {
    console.log(this.age);
};
let p1 = myNew(Person, "lihua", 18);
console.log(p1.name);
console.log(p1);
p1.say();
```
## bind call apply

```js
Function.prototype.myCall = function (obj) {
    if (typeof this !== 'function') {
        throw new TypeError('no function ')
    }
    let fn = this || window;
    let symbol = Symbol();
    let arg = [...arguments].slice(1);
    obj[symbol] = fn;
    let result = obj.fn(...arg);
    delete obj[symbol];
    return result;
}
Function.prototype.myApply = function (context) {
    if (typeof this !== 'function') {
        throw new TypeError('not function')
    }
    let _this = this || window;
    let fn = Symbol();
    context[fn] = _this;
    let result;
    if (arguments[1]) {
        result = context[fn](...arguments[1])
    } else {
        result = context[fn]()
    }
    delete context[fn];
    return result;
}
Function.prototype.myBind = function () {
    let context = [].shift.call(arguments) || window;
    let arg = arguments;
    let fn = this;
    return function fn1 () {
        return this instanceof fn1 ? new fn(...arguments) : fn.apply(context, arg.concat(...arguments))
    }
}

let obj = {t: '33'}
function tt(a,bb) {
    console.log(this.t, a,bb);
}
tt(12,22);
tt.myApply(obj,[12,33])
```

## æ·±æ‹·è´

```js
function deepClone(source) {
    let target = source.constructor  === Array ? [] : {};
    for (const key in source) {
        if (Object.hasOwnProperty.call(source, key)) {
            if (source[key] && typeof source[key] === 'object') {
                target[key] = source[key].constructor === Array ? [] : {};
                target[key] = deepClone(source[key]);
            } else {
                target[key] = source[key]
            }
            
        }
    }
    return target;
}

let obj = {name: '33', arr: [1,3], obj: {cl: 3}}

let c = deepClone(obj);
obj.name = '334';
obj.arr.push(4);
console.log(c);
```
## instanceof

```js
function ttt(name) {
    this.name = name
}

let t = new ttt('jack');

console.log(t.__proto__ === ttt.prototype)
function myInstanceof(cur, target) {
    let pro = target.prototype;
    while(true) {
        if (t.__proto__ === null) {
            return false
        }
        if (t.__proto__ === pro) {
            return true
        }
        t = t.__proto__;
    }
}
console.log(myInstanceof(t, Array))
```

## æŸ¯é‡ŒåŒ–

```js
function curry (fn, ...arg) {
    let length = fn.length;
    let curArg = [].concat(...arg);
    return function next () {
        curArg = curArg.concat(...arguments);
        if (curArg.length >= length) {
            return fn.apply(null, curArg)
        } else {
            return next
        }
    }
}

function add (a, b, c) {
    return a+ b+ c;
}
let fn = curry(add);
console.log(fn(1)(2)(3))

let fn1 = curry(add, 1);
console.log(fn1(1)(2))

```

## æ’åºç®—æ³•

### å†’æ³¡ (æ¯æ¬¡éƒ½ä»ç¬¬ä¸€ä¸ªå¼€å§‹,)

```js
function bubble (arr) {
    let length = arr.length
    for (let i = 0; i < length; i++) {
        let bChange = false;
        for (let j = 0; j < length -1; j++) {
            if (arr[j] > arr[j + 1]) {
                [arr[j + 1], arr[j]] = [arr[j], arr[j + 1]];
                bChange = true;
            }
        }
        if (!bChange) {
            return arr;
        }
    }
    return arr;
}

bubble([1,5,3,4]); bubble([3,2,1,5]
```

### é€‰æ‹© (æ¯æ¬¡åªé€‰æ‹©æœ€å°çš„æ¥æ›¿æ¢)

```js
function selectSort (arr) {
    let length = arr.length;
    for (let i = 0; i < length, i++) {
        let min = i
        for (let j = i + 1; j < length; j++) {
            if (arr[j] < arr[min]) {
                min = j;
            }
        }
        if (min !== i) {
            [arr[min], arr[i]] = [arr[i], arr[min]]
        }
    }
    return arr;
}
```

## é˜²æŠ–èŠ‚æµ

### é˜²æŠ–(æ¯æ¬¡æ¸…é™¤å®šæ—¶å™¨)

```js
function debounce (fn, time) {
    let timeout = null;
    return () => {
        if (timeout) return;
        let timeout = setTimeout(() => {
            fn()
        }, time)
    }
}

```

### èŠ‚æµ (ä¸€æ®µæ—¶é—´åªèƒ½è¿è¡Œä¸€æ¬¡)

```js
function throttle (fn ,time) {
    let canRun = true;
    return () => {
        if (!canRun) return;
        canRun = false;
        setTimeout(() => {
            fn();
            canRun = true
        }, time)
    }
}
```

## ç‰ˆæœ¬å·æ’åº

```js
let sortArr = ['0.1.1', '2.3.3', '0.302.1', '4.2', '4.3.5', '4.3.4.5'];
function versionSort (arg) {
    return arg.sort((a, b) => {
        let arrA = a.split('.');
        let arrB = b.split('.');
        let i = 0
        while (true) {
            if (arrA[i] === arrB[i]) {
                i++;
            } else {
                return arrB[i] - arrA[i]
            }
        }
    })
}
console.log(versionSort(sortArr))
```

## LRUç®—æ³•

```js
class LRUCache {
    constructor (cacheMax) {
        this.cacheMax = cacheMax;
        this.map = new Map()
    }
    put (key, val) {
        // æœ‰
        if (this.map.has(key)) {
            let value = this.map.get(key);
            this.map.delete(key);
            this.map.set(key, value);
        // map æœ‰sizeå±æ€§
        } else if (this.map.size >= this.cacheMax){
            // æ‰“å°å‡º {value: xx, done: false}
            this.map.delete(this.map.keys().next().value)
            this.map.set(key, val);
        } else {
            this.map.set(key, val);
        }
        return true;
    }
    get (key) {
        // æœ‰ æ›´æ–°åˆ°æœ€å
        if (this.map.has(key)) {
            let value= this.map.get(key);
            this.map.delete(key);
            this.map.set(key, value);
            return value;
        } else {
            return -1
        }
    }
}
let cache = new LRUCache(2);
cache.put(1, 1);
cache.put(2, 2);
console.log("cache.get(1)", cache.get(1))// è¿”å›  1
cache.put(3, 3);// è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ
console.log("cache.get(2)", cache.get(2))// è¿”å› -1 (æœªæ‰¾åˆ°)
cache.put(4, 4);// è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ
console.log("cache.get(1)", cache.get(1))// è¿”å› -1 (æœªæ‰¾åˆ°)
console.log("cache.get(3)", cache.get(3))// è¿”å›  3
console.log("cache.get(4)", cache.get(4))// è¿”å›  4
```

## ç®­å¤´å‡½æ•°

```js
let obj = {
    a: 1,
    b: () => console.log(this),
    c: function () {
        return () => console.log(this);
    },
    d: {
        e: () => console.log(this)
    }
}
// window
console.log(obj.b)
// obj
console.log(obj.c()())
// window
console.log(obj.d.e())
```

[ã€å»ºè®®ğŸ‘ã€‘å†æ¥40é“thisé¢è¯•é¢˜é…¸çˆ½ç»§ç»­(1.2wå­—ç”¨æ‰‹æ•´ç†)](https://juejin.cn/post/6844904083707396109)

## åˆ¤æ–­æ­£0å’Œè´Ÿ0

1/-0  -Infinity
1/+0 Infinity

## æ‰‹å†™ajax

```js
const getJson = function () {
    return new Promise((resolve, reject) => {
        let xhr = new XMLHttpRequest();
        // async æ˜¯å¦å¼‚æ­¥ é»˜è®¤true
        xhr.open('get', url, false);
        xhr.setHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function () {
            if (xhr.readyState !== 4) {
                return
            }
            if (xhr.statue === 200) {
                resolve(xhr.responseText);
            } else {
                reject(new Error(xhr.responseText))
            }
        }
        xhr.send()
    })
}
```