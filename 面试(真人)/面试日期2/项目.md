# 项目经验

开发维护机器人平台, 维护fun组件库, 维护动态表单支持表单配置,集成外呼功能到crm, 并集成工单系统处理审批内容,整理埋点信息内容支撑产品决策,

## 动态表单

[从零实现一个动态表单设计 (编辑) 器](https://xie.infoq.cn/article/e0881ff77eb4017afd550d84b)

## 组件动态加载

组件异步加载处理 `React-loadable`

```tsx
{
    path: '/approval/index/detail/:type/:id/:code',
    component: Loadable(() => import('shared-pages/approval/detail')),
    auth: 'approval_center'
}

import Loadable from 'react-loadable'
export default function<Props>(
  loader: () => Promise<React.ComponentType<Props> | { default: React.ComponentType<Props> }>
) {
  return Loadable({
    loader,
    delay: 300,
    loading: Loading //自己的loading组件
  })
}
```

原理: 先用占位符, 然后在加载 import('xx) 组件
[react-loadable原理浅析](https://www.jianshu.com/p/0b4739b13381)

## 机器人平台

主要支持群组机器人推送, 创建机器人插件, 插件关联机器人.提供gitlab webhook消息, 自定义内容消息, 定时消息等推送功能
前端集成代码编辑器,并创建沙盒环境进行测试模拟
前端用了: monaco-editor
tsp平台
沙盒

## fun组件

[通用组件](https://juejin.cn/post/6844903847874265101)

1. css通过 css in js (生成内联样式) (不用全局引入 xx.css 文件)
2. Storybook组件开发调试,docz展示组件文档 (@youzan/docz) (demo演示,同时不支持mdx文件展示)
3. 单元测试要求,降低组件维护出错率
4. 采用rollup打包 (rollup 更简洁,打出来的包更小) tree shaking也是rollup率先支持的 (Scope Hoisting把所有模块构建在一个函数内，执行效率更高)
    由于 webpack 不得不在打包代码中构建模块系统来适应 app 开发(模块系统对于单一类库用处很小

组件设计

1. 细粒度 (每个组件都有单一的职责,同时建立在可复用的情况下, 不可复用作为独立组件内部组件)
2. 通用性 (但是通用也要保证扩展性好)

### rollup 插件

```js
import babel from 'rollup-plugin-babel'
//  解决rollup无法识别commonjs的问题
import commonjs from 'rollup-plugin-commonjs'
// resolve将我们编写的源码与依赖的第三方库进行合并
import nodeResolve from 'rollup-plugin-node-resolve'
import replace from 'rollup-plugin-replace'
import { uglify } from 'rollup-plugin-uglify'
```

### css 实现方式 (css in js)

两种实现方式:

1. 唯一CSS选择器(`styled-components` 动态生成一个css选择器,style标签插入到head中,动态生成css选择器是用一段hash值保持唯一)
2. 内联样式 (为dom添加相应内联样式, 方便调试,样式优先级高,自带局部样式作用域)

好处: 局部样式避免影响;避免无用的css;更好基于状态的样式定义;更利于组件库封装;不用等待css资源文件下载时间
坏处: 上手难度;代码可读性差;没有统一的业界标准;运行时动态生成对内存有消耗;
[CSS in JS的好与坏](https://juejin.cn/post/6844904051369328648)
[@material-ui/styles](https://mui.com/zh/system/styles/basics/)

`fun-button-primary`

[@material-ui](https://v4.mui.com/zh/components/box/)

### 单元测试

```js
expect(hasClass('fun-icon')).toBe(true) // 类型
expect(attr('type')).toEqual('add') // 属性
// 找到标签的元素, getComputedStyle获得元素所以属性, getPropertyValue 获取属性值
expect(getComputedStyle(wrapperDefault.find('svg').getDOMNode()).getPropertyValue('font-size'))).toBe('24px')
// 挂载元素
const wrapper = mount(<Icon type="add" onClick={handleClick} />)
// 触发点击
wrapper.simulate('click')
// handleClick 被调用 几次
expect(handleClick.mock.calls.length).toBe(1)
```

## ep-node-api

## 动态表单(funeng权限)

添加动态表单内容,支持 crm 表单生成,方便产品直接配置快速开发功能
分为页面项, 元素

## 外呼

## 工单系统

## fun-pro

## 埋点系统

## esbuild

esbuild-loader
